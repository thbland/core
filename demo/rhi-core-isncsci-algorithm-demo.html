<!--
@license
Copyright (c) 2015 Rick Hansen Institute. All rights reserved.
This code may only be used under the modified Apache license found at https://raw.githubusercontent.com/EddieMachete/rhi-core-isncsci-algorithm/master/LICENSE
Author: RhiTech <tech@rickhanseninstitute.org>
-->
<link rel="import" href="../../../bower_components/polymer/polymer.html"/>
<link rel="import" href="../../../bower_components/iron-demo-helpers/demo-snippet.html" />
<link rel="import" href="../../../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../../../bower_components/paper-styles/paper-styles.html"/>
<link rel="import" href="../rhi-core-isncsci-exam.html" />
<link rel="import" href="../rhi-core-isncsci-binary-observation.html" />
<link rel="import" href="../rhi-core-isncsci-algorithm.html" />
<link rel="import" href="rhi-core-isncsci-algorithm-demo-exam.html" />
<dom-module id="rhi-core-isncsci-algorithm-demo">
    <!-- Optional shadow DOM template -->
    <template>
        <style>
            .background-orange {
                background-color: #F15A24;
            }
            
            .color-dark-medium {
                color: #666;
            }
            
            .color-white {
                color: #FFF;
            }
            
            .font-size-normal {
                font-size: 13px;
            }
            
            .details {
                margin: 24px 0;
            }
        </style>
        <!-- shadow DOM for your element -->
        <div class="controls">
            <paper-button raised
                          class="background-orange color-white"
                          on-click="loadTest_clicked">Load new random test</paper-button>
        </div>
        <div class="details color-dark-medium font-body-1">
        Forms are loaded randomly from /tests/isncsci-tests.js
        </div>
        <rhi-core-isncsci-algorithm-tests-helpers id="testHelpers"></rhi-core-isncsci-algorithm-tests-helpers>
        <rhi-core-isncsci-algorithm-demo-exam id="demoExam"></rhi-core-isncsci-algorithm-demo-exam>
    </template>
    <script>
        /* global Polymer customElements */
        'use strict';
        
        class RhiCoreIsncsciAlgorithmDemo extends Polymer.Element {
            static get is() { return 'rhi-core-isncsci-algorithm-demo'; }
            
            // Properties for the element's public API
            static get properties() {
                return {
                    tests: {
                        type: Object,
                        value: []
                    }
                };
            }

            loadRandomTest() {
                if (!this.tests || !this.tests.length)
                    return;

                let randomTest = this.tests[Math.floor((Math.random() * this.tests.length))];
                let isncsciExam = new IsncsciExam();

                this.bindExamToTest(isncsciExam, randomTest);
                this.$.demoExam.setExam(isncsciExam, randomTest.comments);
                this.$.demoExam.setTotals(Algorithm.getTotalsFor(isncsciExam));
            }

            bindExamToTest(isncsciExam, test) {
                var keys = ['C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8',
                            'T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12',
                            'L1', 'L2', 'L3', 'L4', 'L5', 'S1', 'S2', 'S3', 'S4_5'];
                var dermatomes = test.dermatomes;
                isncsciExam.analContraction = this.getBinaryObservationFor(test.analContraction);
                isncsciExam.analSensation = this.getBinaryObservationFor(test.analSensation);
                
                if (test.rightLowestNonKeyMuscleWithMotorFunction
                        && test.rightLowestNonKeyMuscleWithMotorFunction.length > 1)
                    isncsciExam.setRightLowestNonKeyMuscleWithMotorFunction(test.rightLowestNonKeyMuscleWithMotorFunction);
                
                if (test.leftLowestNonKeyMuscleWithMotorFunction
                        && test.leftLowestNonKeyMuscleWithMotorFunction.length > 1)
                    isncsciExam.setLeftLowestNonKeyMuscleWithMotorFunction(test.leftLowestNonKeyMuscleWithMotorFunction);
                
                for (var i=0; i<keys.length; i++) {
                    var key = keys[i];
                    var dermatome = dermatomes[key];
                    isncsciExam.updateLevelByName(key, dermatome.rightTouch, dermatome.leftTouch, dermatome.rightPrick, dermatome.leftPrick, dermatome.rightMotor, dermatome.leftMotor);
                }
            }

            getBinaryObservationFor(value) {
                var valueToLower = value ? value.toLowerCase() : 'none';
                    
                if (valueToLower === 'yes')
                    return BinaryObservation.yes;
                    
                if (valueToLower === 'no')
                    return BinaryObservation.no;
                    
                if (valueToLower === 'nt')
                    return BinaryObservation.nt;
                
                return BinaryObservation.none;
            }

            loadTest_clicked() {
                this.loadRandomTest();
            }
        }
        
        customElements.define(RhiCoreIsncsciAlgorithmDemo.is, RhiCoreIsncsciAlgorithmDemo);
    </script>
</dom-module>